From 9035f73d9a2e91217937a1718f4a56583dd3d647 Mon Sep 17 00:00:00 2001
From: "Chenggen.Wang" <wangchenggen@canaan-creative.com>
Date: Fri, 2 Sep 2022 22:07:43 +0800
Subject: [PATCH] gc2053 add 800*1080 resolution

---
 .../media/i2c/soc_camera/canaanchip/gc2053.c  | 167 ++++++++++++++++++
 1 file changed, 167 insertions(+)

diff --git a/drivers/media/i2c/soc_camera/canaanchip/gc2053.c b/drivers/media/i2c/soc_camera/canaanchip/gc2053.c
index 78611299..1f376c73 100755
--- a/drivers/media/i2c/soc_camera/canaanchip/gc2053.c
+++ b/drivers/media/i2c/soc_camera/canaanchip/gc2053.c
@@ -142,6 +142,161 @@ static const struct regval gc2053_stop[] = {
 	{REG_NULL, 0x00},
 };
 
+/*
+ * window_size=800*1080 mipi@2lane
+ * mclk=24mhz,mipi_clk=594Mbps
+ * pixel_line_total=2200,line_frame_total=1125
+ * row_time=29.629us,frame_rate=30fps
+ */
+static const struct regval gc2053_800x1080_regs_2lane[] = {
+	/****system****/
+	{0xfe, 0x80},
+	{0xfe, 0x80},
+	{0xfe, 0x80},
+	{0xfe, 0x00},
+	{0xf2, 0x00},
+	{0xf3, 0x00},
+	{0xf4, 0x36},
+	{0xf5, 0xc0},
+	{0xf6, 0x44},
+	{0xf7, 0x01},
+	{0xf8, 0x63},
+	{0xf9, 0x40},
+	{0xfc, 0x8e},
+	/****CISCTL & ANALOG****/
+	{0xfe, 0x00},
+	{0x87, 0x18},
+	{0xee, 0x30},
+	{0xd0, 0xb7},
+	{0x03, 0x04},
+	{0x04, 0x60},
+	{0x05, 0x04},
+	{0x06, 0x4c},
+	{0x07, 0x00},
+	{0x08, 0x11},
+	{0x09, 0x00},
+	{0x0a, 0x02},
+	{0x0b, 0x00},
+	{0x0c, 0x02},
+	{0x0d, 0x04},
+	{0x0e, 0x40},
+	{0x12, 0xe2},
+	{0x13, 0x16},
+	{0x19, 0x0a},
+	{0x21, 0x1c},
+	{0x28, 0x0a},
+	{0x29, 0x24},
+	{0x2b, 0x04},
+	{0x32, 0xf8},
+	{0x37, 0x03},
+	{0x39, 0x15},
+	{0x43, 0x07},
+	{0x44, 0x40},
+	{0x46, 0x0b},
+	{0x4b, 0x20},
+	{0x4e, 0x08},
+	{0x55, 0x20},
+	{0x66, 0x05},
+	{0x67, 0x05},
+	{0x77, 0x01},
+	{0x78, 0x00},
+	{0x7c, 0x93},
+	{0x8c, 0x12},
+	{0x8d, 0x92},
+	{0x90, 0x01},
+	{0x9d, 0x10},
+	{0xce, 0x7c},
+	{0xd2, 0x41},
+	{0xd3, 0xdc},
+	{0xe6, 0x50},
+	/*gain*/
+	{0xb6, 0xc0},
+	{0xb0, 0x60},
+	{0xb1, 0x01},
+	{0xb2, 0x00},
+	{0xb3, 0x00},
+	{0xb4, 0x00},
+	{0xb8, 0x01},
+	{0xb9, 0x00},
+	/*blk*/
+	{0x26, 0x30},
+	{0xfe, 0x01},
+	{0x40, 0x23},
+	{0x55, 0x07},
+	{0x60, 0x40},
+	{0xfe, 0x04},
+	{0x14, 0x78},
+	{0x15, 0x78},
+	{0x16, 0x78},
+	{0x17, 0x78},
+	/*window*/
+	{0xfe, 0x01},
+	{0x91, 0x00}, //Out Window Y1[10:8]
+	{0x92, 0x02}, //Out Window Y1[7:0]
+	{0x93, 0x02}, //Out Window X1[11:8]
+	{0x94, 0x2f}, //Out Window X1[7:0]
+	{0x95, 0x04}, //Out Window Height[10:8] 1080=0438
+	{0x96, 0x38}, //Out Window Height[7:0]  
+	{0x97, 0x03}, //Out Window Width[11:8]  1920=0780
+	{0x98, 0x20}, //Out Window Width[7:0] 800=0320
+
+	/*ISP*/
+	{0xfe, 0x01},
+	{0x01, 0x05},
+	{0x02, 0x89},
+	{0x04, 0x01},
+	{0x07, 0xa6},
+	{0x08, 0xa9},
+	{0x09, 0xa8},
+	{0x0a, 0xa7},
+	{0x0b, 0xff},
+	{0x0c, 0xff},
+	{0x0f, 0x00},
+	{0x50, 0x1c},
+	{0x89, 0x03},
+	{0xfe, 0x04},
+	{0x28, 0x86},
+	{0x29, 0x86},
+	{0x2a, 0x86},
+	{0x2b, 0x68},
+	{0x2c, 0x68},
+	{0x2d, 0x68},
+	{0x2e, 0x68},
+	{0x2f, 0x68},
+	{0x30, 0x4f},
+	{0x31, 0x68},
+	{0x32, 0x67},
+	{0x33, 0x66},
+	{0x34, 0x66},
+	{0x35, 0x66},
+	{0x36, 0x66},
+	{0x37, 0x66},
+	{0x38, 0x62},
+	{0x39, 0x62},
+	{0x3a, 0x62},
+	{0x3b, 0x62},
+	{0x3c, 0x62},
+	{0x3d, 0x62},
+	{0x3e, 0x62},
+	{0x3f, 0x62},
+	/****DVP & MIPI****/
+	{0xfe, 0x01},
+	{0x9a, 0x06},
+	{0x99, 0x00},
+	{0xfe, 0x00},
+	{0x7b, 0x2a},
+	{0x23, 0x2d},
+	{0xfe, 0x03},
+	{0x01, 0x27},
+	{0x02, 0x56},
+	{0x03, 0x8e},
+	{0x12, 0x20},
+	{0x13, 0x03},
+	{0xfe, 0x00},
+	{0x3e, 0x81},
+	{REG_NULL, 0x00},
+};
+
 /*
  * window_size=1920*1080 mipi@2lane
  * mclk=24mhz,mipi_clk=594Mbps
@@ -307,6 +462,18 @@ static const struct gc2053_mode supported_modes[] = {
 		.vts_def = 0x465,
 		.reg_list = gc2053_1920x1080_regs_2lane,
 	},
+	{
+		.width = 800,
+		.height = 1080,
+		.max_fps = {
+			.numerator = 10000,
+			.denominator = 300000,
+		},
+		.exp_def = 0x460,
+		.hts_def = 0x898,
+		.vts_def = 0x465,
+		.reg_list = gc2053_800x1080_regs_2lane,
+	},
 };
 
 static const s64 link_freq_menu_items[] = {
-- 
2.17.1

